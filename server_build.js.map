{"version":3,"sources":["webpack:///server_build.js","webpack:///webpack/bootstrap 30e470ed300defd838c6","webpack:///./server/utils.js","webpack:///external \"path\"","webpack:///./server/memoryFs.js","webpack:///external \"memory-fs\"","webpack:///external \"webpack\"","webpack:///./server/database.js","webpack:///./server/middleware.js","webpack:///./server/sessions.js","webpack:///external \"fs\"","webpack:///external \"mime\"","webpack:///./server/index.js","webpack:///./server/mongodb.js","webpack:///./server/npm.js","webpack:///./server/preLoadPackages.js","webpack:///./server/sandbox.js","webpack:///./server/sessionBundler.js","webpack:///./server/vendorsBundler.js","webpack:///./start.js","webpack:///external \"body-parser\"","webpack:///external \"compression\"","webpack:///external \"cookie-parser\"","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///external \"mongodb\"","webpack:///external \"npm-extractor\"","webpack:///external \"recursive-readdir\""],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","isProduction","process","env","NODE_ENV","hasPackages","req","body","packages","Object","keys","length","log","message","console","logError","err","getVendorsBundleName","sort","join","readMemDir","fs","dir","logOutDir","dirs","readdirSync","e","forEach","subDir","require","MemoryFileSystem","path","utils","updateSessionFiles","session","files","existsSync","mkdirpSync","file","writeFileSync","name","content","hasVendorsBundle","vendorsBundleName","writeBundle","bundle","manifest","db","memoryFs","connect","getVendorsBundle","bundleName","findOne","then","getVendorsBundleEntries","entries","vendorsBundle","uploadVendorsBundle","result","packagesData","JSON","parse","readFileSync","toString","reduce","packageData","resolve","main","insert","mime","HASH_REGEXP","compiler","options","onFileSystemAdded","invalidPlugin","state","noInfo","quiet","info","invalidAsyncPlugin","callback","ready","fn","url","callbacks","push","rebuild","cb","run","forceRebuild","pathJoin","a","b","getFilenameFromUrl","localPrefix","publicPath","indexOf","test","replace","filename","substr","outputPath","webpackDevMiddleware","res","next","passResponse","processRequest","stat","statSync","isFile","isDirectory","setHeader","lookup","headers","send","end","lazy","watchOptions","watchDelay","warn","aggregateTimeout","stats","context","cwd","str","RegExp","outputFileSystem","plugin","nextTick","displayStats","hasErrors","hasWarnings","cbs","watching","watch","invalidate","close","fileSystem","sessions","middleware","sessionsModule","get","lastUpdate","Date","now","set","update","key","value","clean","filter","remainingSessions","cookies","codebox","String","cookie","expires","domain","httpOnly","createBundleMiddleware","Promise","reject","resolver","sessionMiddleware","colors","hash","timings","chunks","chunkModules","updateVendorsBundle","express","compression","app","cookieParser","bodyParser","preLoadPackages","sandbox","database","setInterval","use","json","getIndex","getFile","post","updateSandbox","MongoClient","connectedDb","collectionName","query","collection","doc","npmExtractor","loadPackages","all","map","package","targetFs","registry","mindelay","maxDelay","retries","factor","dest","recursive","loadedDeps","preLoadPackage","setTimeout","packagePath","packageJson","relativeFile","paths","split","sep","slice","currentPath","pathPart","index","extname","dependencies","vendorsBundler","sessionBundler","npm","createIndex","type","fileName","basename","create","compile","webpack","externals","plugins","DefinePlugin","process.env","stringify","concat","DllReferencePlugin","devtool","entry","App","output","resolveLoader","root","loaders","loader","exclude","presets","inputFileSystem","resolvers","normal","vendorsCompiler","vendors","library","DllPlugin","http","server","createServer","listen","PORT"],"mappings":"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","file":"server_build.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"/build/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(18);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\tmodule.exports = {\n\t  isProduction: function () {\n\t    return process.env.NODE_ENV === 'production';\n\t  },\n\t  hasPackages: function (req) {\n\t    return req.body.packages && Object.keys(req.body.packages).length;\n\t  },\n\t  log: function (message) {\n\t    return function () {\n\t      console.log(message);\n\t    };\n\t  },\n\t  logError: function (err) {\n\t    console.log(err);\n\t  },\n\t  getVendorsBundleName: function (packages) {\n\t    return Object.keys(packages).sort().join('--');\n\t  },\n\t  readMemDir: function (fs, dir) {\n\t    var logOutDir = function (dir) {\n\t      var dirs = [];\n\t      try {\n\t        dirs = fs.readdirSync(dir);\n\t        console.log(dir);\n\t      } catch (e) {\n\t        return;\n\t      }\n\t      dirs.forEach(function (subDir) {\n\t        logOutDir(dir + '/' + subDir);\n\t      });\n\t    }\n\t    logOutDir(dir);\n\t  }\n\t};\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"path\");\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar MemoryFileSystem = __webpack_require__(4);\n\tvar path = __webpack_require__(2);\n\tvar fs = new MemoryFileSystem();\n\tvar utils = __webpack_require__(1);\n\t\n\tmodule.exports = {\n\t  fs: fs,\n\t  updateSessionFiles: function (session, files) {\n\t    if (!fs.existsSync(path.join('/', 'api', 'sandbox', session.id))) {\n\t      fs.mkdirpSync(path.join('/', 'api', 'sandbox', session.id));\n\t    }\n\t\n\t    files.forEach(function (file) {\n\t      fs.writeFileSync(path.join('/', 'api', 'sandbox', session.id, file.name), file.content || ' ');\n\t    });\n\t  },\n\t  hasVendorsBundle: function (packages) {\n\t    var vendorsBundleName = utils.getVendorsBundleName(packages);\n\t    return fs.existsSync(path.join('/', 'api', 'sandbox', 'vendors', vendorsBundleName,  '/bundle.js'));\n\t  },\n\t  writeBundle: function (bundle) {\n\t    console.log('got bundle', Object.keys(bundle), bundle.name);\n\t    fs.mkdirpSync(path.join('/', 'api', 'sandbox', 'vendors', bundle.name));\n\t    fs.writeFileSync(path.join('/', 'api', 'sandbox', 'vendors', bundle.name, 'bundle.js'), bundle.content);\n\t    fs.writeFileSync(path.join('/', 'api', 'sandbox', 'vendors', bundle.name, 'manifest.json'), bundle.manifest);\n\t    return bundle.name;\n\t  }\n\t};\n\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"memory-fs\");\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"webpack\");\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar db = __webpack_require__(12);\n\tvar memoryFs = __webpack_require__(3);\n\tvar utils = __webpack_require__(1);\n\tvar path = __webpack_require__(2);\n\t\n\tmodule.exports = {\n\t  connect: db.connect,\n\t  getVendorsBundle: function (packages) {\n\t    var bundleName = utils.getVendorsBundleName(packages);\n\t    return db.findOne('bundles', {name: bundleName})\n\t      .then(function (bundle) {\n\t        return bundle;\n\t      });\n\t  },\n\t  getVendorsBundleEntries: function (packages) {\n\t    var bundleName = utils.getVendorsBundleName(packages);\n\t    return db.findOne('bundles', {name: bundleName}, {entries: 1})\n\t      .then(function (bundle) {\n\t        return {\n\t          vendorsBundle: bundle.name,\n\t          entries: bundle.entries\n\t        };\n\t      });\n\t  },\n\t  uploadVendorsBundle: function (result) {\n\t    var bundleName = result.bundleName;\n\t    var packagesData = result.packagesData;\n\t    var manifest = JSON.parse(memoryFs.fs.readFileSync(path.join('/', 'api', 'sandbox', 'vendors', bundleName, 'manifest.json')).toString());\n\t\n\t    var entries = packagesData.reduce(function (entries, packageData) {\n\t      entries[packageData.name] = '.' + path.resolve('/', 'node_modules', packageData.name, packageData.main || 'index.js');\n\t      return entries;\n\t    }, {});\n\t    return db.insert('bundles', {\n\t      name: bundleName,\n\t      entries: entries,\n\t      content: memoryFs.fs.readFileSync(path.join('/', 'api', 'sandbox', 'vendors', bundleName, 'bundle.js')).toString(),\n\t      manifest: memoryFs.fs.readFileSync(path.join('/', 'api', 'sandbox', 'vendors', bundleName, 'manifest.json')).toString()\n\t    })\n\t    .then(function () {\n\t      return {\n\t        vendorsBundle: bundleName,\n\t        entries: entries\n\t      };\n\t    })\n\t    .catch(utils.logError)\n\t  }\n\t}\n\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/*\n\t\tMIT License http://www.opensource.org/licenses/mit-license.php\n\t\tAuthor Tobias Koppers @sokra\n\t*/\n\tvar MemoryFileSystem = __webpack_require__(4);\n\tvar mime = __webpack_require__(10);\n\t\n\tvar HASH_REGEXP = /[0-9a-f]{10,}/;\n\t\n\t// constructor for the middleware\n\tmodule.exports = function(compiler, options, onFileSystemAdded) {\n\t\tif(!options) options = {};\n\t\tif(typeof options.watchOptions === \"undefined\") options.watchOptions = {};\n\t\tif(typeof options.watchDelay !== \"undefined\") {\n\t\t\t// TODO remove this in next major version\n\t\t\tconsole.warn(\"options.watchDelay is deprecated: Use 'options.watchOptions.aggregateTimeout' instead\");\n\t\t\toptions.watchOptions.aggregateTimeout = options.watchDelay;\n\t\t}\n\t\tif(typeof options.watchOptions.aggregateTimeout === \"undefined\") options.watchOptions.aggregateTimeout = 200;\n\t\tif(typeof options.stats === \"undefined\") options.stats = {};\n\t\tif(!options.stats.context) options.stats.context = process.cwd();\n\t\tif(options.lazy) {\n\t\t\tif(typeof options.filename === \"string\") {\n\t\t\t\tvar str = options.filename\n\t\t\t\t\t.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\")\n\t\t\t\t\t.replace(/\\\\\\[[a-z]+\\\\\\]/ig, \".+\");\n\t\t\t\toptions.filename = new RegExp(\"^[\\/]{0,1}\" + str + \"$\");\n\t\t\t}\n\t\t}\n\t\n\t\t// store our files in memory\n\t\tvar files = {};\n\t\tvar fs = compiler.outputFileSystem = new MemoryFileSystem();\n\t\n\t\tonFileSystemAdded && onFileSystemAdded(fs);\n\t\n\t\tcompiler.plugin(\"done\", function(stats) {\n\t\t\t// We are now on valid state\n\t\t\tstate = true;\n\t\t\t// Do the stuff in nextTick, because bundle may be invalidated\n\t\t\t//  if a change happend while compiling\n\t\t\tprocess.nextTick(function() {\n\t\t\t\t// check if still in valid state\n\t\t\t\tif(!state) return;\n\t\t\t\t// print webpack output\n\t\t\t\tvar displayStats = (!options.quiet && options.stats !== false);\n\t\t\t\tif(displayStats &&\n\t\t\t\t\t!(stats.hasErrors() || stats.hasWarnings()) &&\n\t\t\t\t\toptions.noInfo)\n\t\t\t\t\tdisplayStats = false;\n\t\t\t\tif(displayStats) {\n\t\t\t\t\tconsole.log(stats.toString(options.stats));\n\t\t\t\t}\n\t\t\t\tif (!options.noInfo && !options.quiet)\n\t\t\t\t\tconsole.info(\"webpack: bundle is now VALID.\");\n\t\n\t\t\t\t// execute callback that are delayed\n\t\t\t\tvar cbs = callbacks;\n\t\t\t\tcallbacks = [];\n\t\t\t\tcbs.forEach(function continueBecauseBundleAvailible(cb) {\n\t\t\t\t\tcb();\n\t\t\t\t});\n\t\t\t});\n\t\n\t\t\t// In lazy mode, we may issue another rebuild\n\t\t\tif(forceRebuild) {\n\t\t\t\tforceRebuild = false;\n\t\t\t\trebuild();\n\t\t\t}\n\t\t});\n\t\n\t\t// on compiling\n\t\tfunction invalidPlugin() {\n\t\t\tif(state && (!options.noInfo && !options.quiet))\n\t\t\t\tconsole.info(\"webpack: bundle is now INVALID.\");\n\t\t\t// We are now in invalid state\n\t\t\tstate = false;\n\t\t}\n\t\tfunction invalidAsyncPlugin(compiler, callback) {\n\t\t\tconsole.log('watch running!');\n\t\t\tinvalidPlugin();\n\t\t\tcallback();\n\t\t}\n\t\tcompiler.plugin(\"invalid\", invalidPlugin);\n\t\tcompiler.plugin(\"watch-run\", invalidAsyncPlugin);\n\t\tcompiler.plugin(\"run\", invalidAsyncPlugin);\n\t\n\t\t// the state, false: bundle invalid, true: bundle valid\n\t\tvar state = false;\n\t\n\t\t// in lazy mode, rebuild automatically\n\t\tvar forceRebuild = false;\n\t\n\t\t// delayed callback\n\t\tvar callbacks = [];\n\t\n\t\t// wait for bundle valid\n\t\tfunction ready(fn, req) {\n\t\t\tif(state) return fn();\n\t\t\tif(!options.noInfo && !options.quiet)\n\t\t\t\tconsole.log(\"webpack: wait until bundle finished: \" + req.url);\n\t\t\tcallbacks.push(fn);\n\t\t}\n\t\n\t\t// start watching\n\t\tif(!options.lazy) {\n\t\t\tvar watching = compiler.watch(options.watchOptions, function(err) {\n\t\t\t\tif(err) throw err;\n\t\t\t});\n\t\t} else {\n\t\t\tstate = true;\n\t\t}\n\t\n\t\tfunction rebuild(cb) {\n\t\t\tif(state) {\n\t\t\t\tstate = false;\n\t\t\t\tcompiler.run(function(err) {\n\t\t\t\t\tif(err) throw err;\n\t\t\t\t\tcb();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tforceRebuild = true;\n\t\t\t}\n\t\t}\n\t\n\t\tfunction pathJoin(a, b) {\n\t\t\treturn a == \"/\" ? \"/\" + b : (a||\"\") + \"/\" + b\n\t\t}\n\t\n\t\tfunction getFilenameFromUrl(url) {\n\t\t\t// publicPrefix is the folder our bundle should be in\n\t\t\tvar localPrefix = options.publicPath || \"/\";\n\t\t\tif(url.indexOf(localPrefix) !== 0) {\n\t\t\t\tif(/^(https?:)?\\/\\//.test(localPrefix)) {\n\t\t\t\t\tlocalPrefix = \"/\" + localPrefix.replace(/^(https?:)?\\/\\/[^\\/]+\\//, \"\");\n\t\t\t\t\t// fast exit if another directory requested\n\t\t\t\t\tif(url.indexOf(localPrefix) !== 0) return false;\n\t\t\t\t} else return false;\n\t\t\t}\n\t\t\t// get filename from request\n\t\t\tvar filename = url.substr(localPrefix.length);\n\t\t\tif(filename.indexOf(\"?\") >= 0) {\n\t\t\t\tfilename = filename.substr(0, filename.indexOf(\"?\"));\n\t\t\t}\n\t\t\treturn filename ? pathJoin(compiler.outputPath, filename) : compiler.outputPath;\n\t\t}\n\t\n\t\t// The middleware function\n\t\tfunction webpackDevMiddleware(req, res, next, bundleName) {\n\t\t\tvar filename = bundleName || getFilenameFromUrl(req.url);\n\t\t\tif (filename === false) return next();\n\t\n\t\t\tvar passResponse = function () {\n\t\t\t\tif(HASH_REGEXP.test(filename)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif(fs.statSync(filename).isFile()) {\n\t\t\t\t\t\t\tprocessRequest();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {}\n\t\t\t\t}\n\t\t\t\t// delay the request until we have a vaild bundle\n\t\t\t\tready(processRequest, req);\n\t\t\t\tfunction processRequest() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvar stat = fs.statSync(filename);\n\t\t\t\t\t\tif(!stat.isFile()) {\n\t\t\t\t\t\t\tif (stat.isDirectory()) {\n\t\t\t\t\t\t\t\tfilename = pathJoin(filename, \"index.html\");\n\t\t\t\t\t\t\t\tstat = fs.statSync(filename);\n\t\t\t\t\t\t\t\tif(!stat.isFile()) throw \"next\";\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthrow \"next\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.log(e, filename);\n\t\t\t\t\t\treturn next();\n\t\t\t\t\t}\n\t\n\t\t\t\t\t// server content\n\t\t\t\t\tconsole.log('reading file', filename);\n\t\t\t\t\tvar content = fs.readFileSync(filename);\n\t\t\t\t\tres.setHeader(\"Access-Control-Allow-Origin\", \"*\"); // To support XHR, etc.\n\t\t\t\t\tres.setHeader(\"Content-Type\", mime.lookup(filename));\n\t\t\t\t\tres.setHeader(\"Content-Length\", content.length);\n\t\t\t\t\tif(options.headers) {\n\t\t\t\t\t\tfor(var name in options.headers) {\n\t\t\t\t\t\t\tres.setHeader(name, options.headers[name]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (res.send) res.send(content);\n\t\t\t\t\telse res.end(content);\n\t\t\t\t}\n\t\t\t}\n\t\n\t\t\t// in lazy mode, rebuild on bundle request\n\t\t\tif(bundleName || (options.lazy && (!options.filename || options.filename.test(filename)))) {\n\t\t\t\tconsole.log('Rebundling');\n\t\t\t\trebuild(passResponse);\n\t\t\t} else {\n\t\t\t\tconsole.log('Passing through');\n\t\t\t\tpassResponse();\n\t\t\t}\n\t\t}\n\t\n\t\twebpackDevMiddleware.getFilenameFromUrl = getFilenameFromUrl;\n\t\n\t\twebpackDevMiddleware.invalidate = function() {\n\t\t\tif(watching) watching.invalidate();\n\t\t};\n\t\twebpackDevMiddleware.close = function(callback) {\n\t\t\tcallback = callback || function(){};\n\t\t\tif(watching) watching.close(callback);\n\t\t\telse callback();\n\t\t};\n\t\n\t\twebpackDevMiddleware.fileSystem = fs;\n\t\n\t\treturn webpackDevMiddleware;\n\t}\n\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar utils = __webpack_require__(1);\n\tvar path = __webpack_require__(2);\n\tvar sessions = {};\n\tvar middleware = __webpack_require__(7);\n\t\n\tvar sessionsModule = {\n\t  get: function (id) {\n\t    var session = sessions[id];\n\t    if (session) {\n\t      sessions[id].lastUpdate = Date.now();\n\t    }\n\t    return session;\n\t  },\n\t  set: function (id) {\n\t    sessions[id] = {id: id, lastUpdate: Date.now()};\n\t    return sessions[id];\n\t  },\n\t  update: function (id, key, value) {\n\t    sessions[id][key] = value;\n\t    return sessions[id];\n\t  },\n\t  clean: function () {\n\t    var now = Date.now();\n\t    console.log('Cleaning sessions: ' + Object.keys(sessions).length);\n\t    sessions = Object.keys(sessions).filter(function (key) {\n\t      return now - sessions[key].lastUpdate < 60 * 1000 * 5;\n\t    }).reduce(function (remainingSessions, key) {\n\t      remainingSessions[key] = sessions[key];\n\t      return remainingSessions;\n\t    }, {});\n\t    console.log('Cleaned sessions: ' + Object.keys(sessions).length);\n\t  },\n\t  middleware: function (req, res, next) {\n\t    if (req.cookies.codebox && sessionsModule.get(req.cookies.codebox)) {\n\t      req.session = sessionsModule.get(req.cookies.codebox);\n\t    } else {\n\t      var id = String(Date.now());\n\t      req.session = sessionsModule.set(id);\n\t      res.cookie('codebox', String(id), {\n\t        expires: 0,\n\t        domain: utils.isProduction() ? 'webpackbin.herokuapp.com' : '.codebox.dev',\n\t        httpOnly: true\n\t      });\n\t    }\n\t    next();\n\t  },\n\t  createBundleMiddleware: function (req, res, next) {\n\t    return function (compiler) {\n\t      return new Promise(function (resolve, reject) {\n\t        console.log('Creating bundle middleware');\n\t        var resolver = function () {\n\t          resolve();\n\t          next();\n\t        };\n\t        var sessionMiddleware = middleware(compiler, {\n\t          lazy: true,\n\t          filename: new RegExp(req.session.id),\n\t          publicPath: path.join('/', 'api', 'sandbox', req.session.id),\n\t          stats: {\n\t            colors: true,\n\t            hash: false,\n\t            timings: true,\n\t            chunks: true,\n\t            chunkModules: false,\n\t            modules: false\n\t          }\n\t        });\n\t        sessionsModule.update(req.session.id, 'middleware', sessionMiddleware);\n\t        sessionMiddleware(req, res, resolver, path.join('/', 'api', 'sandbox', req.session.id, 'webpackbin_bundle.js'));\n\t      });\n\t    };\n\t  },\n\t  updateVendorsBundle: function (session) {\n\t    return function (result) {\n\t      sessions[session.id].vendorsBundle = result.vendorsBundle;\n\t      return result;\n\t    }\n\t  }\n\t};\n\t\n\tmodule.exports = sessionsModule;\n\n\n/***/ },\n/* 9 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"fs\");\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"mime\");\n\n/***/ },\n/* 11 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar express = __webpack_require__(22);\n\tvar webpack = __webpack_require__(5);\n\tvar compression = __webpack_require__(20);\n\tvar app = express();\n\tvar MemoryFileSystem = __webpack_require__(4);\n\tvar memoryFs = __webpack_require__(3);\n\tvar middleware = __webpack_require__(7);\n\tvar fs = __webpack_require__(9);\n\tvar path = __webpack_require__(2);\n\tvar cookieParser = __webpack_require__(21);\n\tvar bodyParser = __webpack_require__(19);\n\tvar sessions = __webpack_require__(8);\n\tvar middlewares = {};\n\tvar preLoadPackages = __webpack_require__(14);\n\tvar utils = __webpack_require__(1);\n\tvar sandbox = __webpack_require__(15);\n\tvar database = __webpack_require__(6);\n\t\n\tpreLoadPackages([\n\t  'process',\n\t  'babel-loader',\n\t  'style-loader',\n\t  'css-loader'\n\t]);\n\t\n\t// Init\n\tmemoryFs.fs.mkdirpSync(path.join('/', 'api', 'sandbox'));\n\tmemoryFs.fs.mkdirpSync(path.join('/', 'api', 'sandbox', 'vendors'));\n\tsetInterval(sessions.clean, 60 * 1000 * 5);\n\tdatabase.connect('mongodb://localhost:27017/webpackbin')\n\t  .then(utils.log('Database connected'))\n\t  .catch(utils.log('Could not connect to database'));\n\t\n\t// Init middleware\n\tapp.use(compression())\n\tapp.use(cookieParser());\n\tapp.use(bodyParser.json());\n\tapp.use(sessions.middleware);\n\tapp.use(express.static(path.resolve('public')));\n\t\n\tapp.get('/', function(req, res) {\n\t  res.send(fs.readFileSync(\n\t    path.resolve('index.html')).toString().replace('/build/bundle.js', '/client_build.js')\n\t  );\n\t});\n\t\n\tapp.get('/api/sandbox/', sandbox.getIndex);\n\t\n\tapp.get('/api/sandbox/*', sandbox.getFile)\n\t\n\tapp.post('/api/sandbox', sandbox.updateSandbox);\n\t\n\tmodule.exports = app;\n\n\n/***/ },\n/* 12 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar utils = __webpack_require__(1);\n\tvar MongoClient = __webpack_require__(24).MongoClient;\n\tvar db = null;\n\t\n\tmodule.exports = {\n\t  connect: function (url) {\n\t    return new Promise(function (resolve, reject) {\n\t      MongoClient.connect(url, function(err, connectedDb) {\n\t        if (err) {\n\t          return reject(err);\n\t        }\n\t        db = connectedDb;\n\t        resolve();\n\t      });\n\t    })\n\t  },\n\t  findOne: function (collectionName, query, options) {\n\t    return new Promise(function (resolve, reject) {\n\t      var collection = db.collection(collectionName);\n\t      collection.findOne(query, options || {}, function (err, doc) {\n\t        if (err) {\n\t          return reject(err);\n\t        }\n\t        resolve(doc);\n\t      });\n\t    });\n\t  },\n\t  insert: function (collectionName, doc) {\n\t    return new Promise(function (resolve, reject) {\n\t      var collection = db.collection(collectionName);\n\t      collection.insert(doc, function (err, doc) {\n\t        if (err) {\n\t          return reject(err);\n\t        }\n\t        resolve(doc);\n\t      });\n\t    });\n\t  }\n\t};\n\n\n/***/ },\n/* 13 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar npmExtractor = __webpack_require__(25);\n\tvar memoryFs = __webpack_require__(3);\n\tvar utils = __webpack_require__(1);\n\t\n\tmodule.exports = {\n\t  loadPackages: function (packages) {\n\t    console.log('Load packages', packages, Object.keys(packages));\n\t    return Promise.all(Object.keys(packages).map(function (key) {\n\t      return npmExtractor({\n\t        package: key,\n\t        targetFs: memoryFs.fs,\n\t        options: {\n\t          registry: 'http://registry.npmjs.org/',\n\t          mindelay: 5000,\n\t          maxDelay: 10000,\n\t          retries: 5,\n\t          factor: 5\n\t        },\n\t        dest: 'node_modules'\n\t      });\n\t    }))\n\t    .then(function (packagesData) {\n\t      console.log('Loaded packages into memory');\n\t      return {\n\t        packages: packages,\n\t        packagesData: packagesData\n\t      };\n\t    })\n\t    .catch(function (err) {\n\t      console.log(err);\n\t    });\n\t  }\n\t};\n\n\n/***/ },\n/* 14 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar memoryFs = __webpack_require__(3);\n\tvar path = __webpack_require__(2);\n\tvar fs = __webpack_require__(9);\n\tvar recursive = __webpack_require__(26);\n\t\n\tvar loadedDeps = [];\n\t\n\tvar preLoadPackage = function (name) {\n\t  if (loadedDeps.indexOf(name) >= 0) {\n\t    return;\n\t  }\n\t  loadedDeps.push(name);\n\t  setTimeout(function () {\n\t    var packagePath = path.resolve('node_modules', name);\n\t    var packageJson = JSON.parse(fs.readFileSync(path.join(packagePath, 'package.json')).toString());\n\t\n\t    recursive(packagePath, function (err, files) {\n\t      files.forEach(function (file) {\n\t        var relativeFile = file;\n\t        var paths = relativeFile.split(path.sep).slice(1);\n\t        paths.reduce(function (currentPath, pathPart, index) {\n\t          currentPath += path.sep + pathPart;\n\t          if (index < paths.length - 1 && !memoryFs.fs.existsSync(currentPath)) {\n\t            memoryFs.fs.mkdirpSync(currentPath);\n\t          }\n\t          return currentPath;\n\t        }, '');\n\t\n\t        if (path.extname(relativeFile)) {\n\t          var content = fs.readFileSync(file, 'utf8');\n\t          memoryFs.fs.writeFileSync(relativeFile, content || ' ');\n\t        }\n\t      });\n\t    });\n\t    Object.keys(packageJson.dependencies || {}).forEach(preLoadPackage);\n\t  })\n\t}\n\t\n\tmodule.exports = function (packages) {\n\t  packages.forEach(preLoadPackage);\n\t};\n\n\n/***/ },\n/* 15 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar db = __webpack_require__(6);\n\tvar vendorsBundler = __webpack_require__(17);\n\tvar sessionBundler = __webpack_require__(16);\n\tvar memoryFs = __webpack_require__(3);\n\tvar utils = __webpack_require__(1);\n\tvar sessions = __webpack_require__(8);\n\tvar npm = __webpack_require__(13);\n\tvar path = __webpack_require__(2);\n\tvar mime = __webpack_require__(10);\n\t\n\tvar createIndex = function (req) {\n\t  return [\n\t    '<!DOCTYPE html>',\n\t    '<html>',\n\t    ' <head>',\n\t    '   <script>',\n\t    '     window.addEventListener(\"load\", function () {window.parent.postMessage({type: \"loaded\"}, location.origin)});',\n\t    '   </script>',\n\t    ' </head>',\n\t    ' <body>',\n\t    '   <div id=\"app\"></div>',\n\t    req.session.vendorsBundle ? '   <script src=\"/api/sandbox/vendors/' + req.session.vendorsBundle + '/bundle.js\" defer></script>' : '',\n\t    '   <script src=\"/api/sandbox/webpackbin_bundle.js\" defer></script>',\n\t    ' </body>',\n\t    '</html>'\n\t  ].join('\\n')\n\t}\n\t\n\tmodule.exports = {\n\t  getIndex: function (req, res) {\n\t    res.type('html');\n\t    res.send(createIndex(req));\n\t  },\n\t  getFile: function (req, res, next) {\n\t    if (/webpackbin_bundle\\.js/.test(req.url)) {\n\t      req.url = req.url.replace('webpackbin_bundle.js', req.session.id + '/webpackbin_bundle.js');\n\t      req.session.middleware(req, res, next);\n\t      return;\n\t    }\n\t\n\t    if (/\\/api\\/sandbox\\/vendors/.test(req.url)) {\n\t      console.log('Getting vendors bundle', req.url);\n\t      var fileName = path.basename(req.url);\n\t      var content = memoryFs.fs.readFileSync(req.url);\n\t      res.setHeader('Cache-Control', 'public, max-age=3600000');\n\t      res.setHeader(\"Content-Type\", mime.lookup(fileName));\n\t      res.setHeader(\"Content-Length\", content.length);\n\t      res.send(content);\n\t      return\n\t    }\n\t  },\n\t  updateSandbox: function (req, res, next) {\n\t\n\t    memoryFs.updateSessionFiles(req.session, req.body.files);\n\t\n\t    if (req.session.middleware) {\n\t      return res.send({});\n\t    }\n\t\n\t    if (\n\t      !req.session.middleware &&\n\t      utils.hasPackages(req) &&\n\t      !memoryFs.hasVendorsBundle(req.body.packages)\n\t    ) {\n\t\n\t      return db.getVendorsBundle(req.body.packages)\n\t        .then(function (bundle) {\n\t          if (bundle) {\n\t            memoryFs.writeBundle(bundle);\n\t            return bundle.name;\n\t          } else {\n\t            return npm.loadPackages(req.body.packages)\n\t              .then(vendorsBundler.compile)\n\t              .then(db.uploadVendorsBundle);\n\t          }\n\t        })\n\t        .then(sessions.updateVendorsBundle(req.session))\n\t        .then(sessionBundler.create(req.session))\n\t        .then(sessions.createBundleMiddleware(req, res, next))\n\t        .catch(utils.logError);\n\t\n\t    } else if (\n\t      !req.session.middleware &&\n\t      utils.hasPackages(req) &&\n\t      memoryFs.hasVendorsBundle(req.body.packages)\n\t    ) {\n\t\n\t      sessions.updateVendorsBundle(req.session)(utils.getVendorsBundleName(req.body.packages));\n\t\n\t      db.getVendorsBundleEntries(req.body.packages)\n\t        .then(sessionBundler.create(req.session))\n\t        .then(sessions.createBundleMiddleware(req, res, next))\n\t        .catch(utils.logError);\n\t\n\t    } else if (\n\t      !req.session.middleware\n\t    ) {\n\t      sessionBundler.create(req.session)()\n\t        .then(sessions.createBundleMiddleware(req, res, next))\n\t        .catch(utils.logError);\n\t    }\n\t  }\n\t};\n\n\n/***/ },\n/* 16 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar webpack = __webpack_require__(5);\n\tvar memoryFs = __webpack_require__(3);\n\tvar path = __webpack_require__(2);\n\tvar utils = __webpack_require__(1);\n\t\n\tmodule.exports = {\n\t  create: function (session) {\n\t    return function (result) {\n\t      var vendorsBundleName = result.vendorsBundle;\n\t      var entries = result.entries;\n\t      \n\t      console.log('Got bundle', vendorsBundleName);\n\t      return new Promise(function (resolve, reject) {\n\t\n\t        var externals = null;\n\t        var plugins = [\n\t          new webpack.DefinePlugin({\n\t            'process.env': {\n\t              'NODE_ENV': JSON.stringify('production'),\n\t            }\n\t          })\n\t        ];\n\t\n\t        if (vendorsBundleName) {\n\t          var manifest = JSON.parse(memoryFs.fs.readFileSync(path.join('/', 'api', 'sandbox', 'vendors', vendorsBundleName, 'manifest.json')).toString());\n\t          plugins = plugins.concat(\n\t            new webpack.DllReferencePlugin({\n\t              context: '/',\n\t              manifest: manifest\n\t            })\n\t          );\n\t\n\t          console.log(entries);\n\t          if (entries) {\n\t            externals = Object.keys(entries).reduce(function (externals, key) {\n\t              externals[key] = 'webpackbin_vendors(' + manifest.content[entries[key]] + ')';\n\t              return externals;\n\t            }, {});\n\t          }\n\t\n\t        }\n\t\n\t        console.log(externals);\n\t\n\t        var compiler = webpack({\n\t          devtool: 'cheap-eval-source-map',\n\t          entry: {\n\t            App: path.join('/', 'api', 'sandbox', session.id, 'main.js')\n\t          },\n\t          output: {\n\t            path: path.join('/', 'api', 'sandbox', session.id),\n\t            filename: 'webpackbin_bundle.js'\n\t          },\n\t          resolveLoader: {\n\t            root: path.resolve('node_modules')\n\t          },\n\t          resolve: {\n\t            root: path.join('/', 'node_modules')\n\t          },\n\t          externals: externals,\n\t          module: {\n\t            loaders: [{\n\t              test: /\\.css?$/,\n\t              loader: 'style!css?modules&localIdentName=[name]---[local]---[hash:base64:5]'\n\t            }, {\n\t              test: /\\.js?$/,\n\t              exclude: /node_modules/,\n\t              loader: 'babel',\n\t              query: {\n\t                \"presets\": [\"react\", \"es2015\", \"stage-0\"]\n\t              }\n\t            }]\n\t          },\n\t          plugins: plugins\n\t        });\n\t\n\t        compiler.inputFileSystem = memoryFs.fs;\n\t        compiler.resolvers.normal.fileSystem = memoryFs.fs;\n\t        compiler.resolvers.context.fileSystem = memoryFs.fs;\n\t\n\t        console.log('Bundler created');\n\t\n\t        resolve(compiler);\n\t      });\n\t    }\n\t  }\n\t};\n\n\n/***/ },\n/* 17 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar webpack = __webpack_require__(5);\n\tvar utils = __webpack_require__(1);\n\tvar memoryFs = __webpack_require__(3);\n\tvar path = __webpack_require__(2);\n\tvar utils = __webpack_require__(1);\n\t\n\tmodule.exports = {\n\t  compile: function (result) {\n\t    var packages = result.packages;\n\t    return new Promise(function (resolve, reject) {\n\t      var bundleName = utils.getVendorsBundleName(packages);\n\t          console.log('creating compiler', bundleName);\n\t      var vendorsCompiler = webpack({\n\t        entry: {\n\t          vendors: Object.keys(packages)\n\t        },\n\t        output: {\n\t          path: path.join('/', 'api', 'sandbox', 'vendors', bundleName),\n\t          filename: 'bundle.js',\n\t          library: 'webpackbin_vendors'\n\t        },\n\t        resolveLoader: {\n\t          root: path.resolve('node_modules')\n\t        },\n\t        resolve: {\n\t          root: path.join('/', 'node_modules')\n\t        },\n\t        plugins: [\n\t          new webpack.DllPlugin({\n\t           path: path.join('/', 'api', 'sandbox', 'vendors', bundleName, 'manifest.json'),\n\t           name: 'webpackbin_vendors',\n\t           context: '/'\n\t         })\n\t        ]\n\t      });\n\t      vendorsCompiler.outputFileSystem = memoryFs.fs;\n\t      vendorsCompiler.inputFileSystem = memoryFs.fs;\n\t      vendorsCompiler.resolvers.normal.fileSystem = memoryFs.fs;\n\t      vendorsCompiler.resolvers.context.fileSystem = memoryFs.fs;\n\t      console.log('running compiler');\n\t      vendorsCompiler.run(function (err) {\n\t        console.log('Compiled vendors');\n\t        if (err) {\n\t          return reject(err);\n\t        }\n\t        resolve({\n\t          bundleName: bundleName,\n\t          packagesData: result.packagesData\n\t        });\n\t      });\n\t    })\n\t    .catch(utils.logError);\n\t  }\n\t};\n\n\n/***/ },\n/* 18 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar app = __webpack_require__(11),\n\t    http = __webpack_require__(23);\n\t\n\tvar server = http.createServer(app);\n\t\n\tserver.listen(process.env.NODE_ENV === 'production' ? process.env.PORT : 4000);\n\t\n\tif (false) {\n\t\n\t  // This will handle HMR and reload the server\n\t  module.hot.accept('./server', function() {\n\t    server.removeListener('request', app);\n\t    app = require('./server');\n\t    server.on('request', app);\n\t    console.log('Server reloaded!');\n\t  });\n\t}\n\n\n/***/ },\n/* 19 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"body-parser\");\n\n/***/ },\n/* 20 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"compression\");\n\n/***/ },\n/* 21 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"cookie-parser\");\n\n/***/ },\n/* 22 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"express\");\n\n/***/ },\n/* 23 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"http\");\n\n/***/ },\n/* 24 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"mongodb\");\n\n/***/ },\n/* 25 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"npm-extractor\");\n\n/***/ },\n/* 26 */\n/***/ function(module, exports) {\n\n\tmodule.exports = require(\"recursive-readdir\");\n\n/***/ }\n/******/ ]);\n\n\n/** WEBPACK FOOTER **\n ** server_build.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/build/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 30e470ed300defd838c6\n **/","module.exports = {\n  isProduction: function () {\n    return process.env.NODE_ENV === 'production';\n  },\n  hasPackages: function (req) {\n    return req.body.packages && Object.keys(req.body.packages).length;\n  },\n  log: function (message) {\n    return function () {\n      console.log(message);\n    };\n  },\n  logError: function (err) {\n    console.log(err);\n  },\n  getVendorsBundleName: function (packages) {\n    return Object.keys(packages).sort().join('--');\n  },\n  readMemDir: function (fs, dir) {\n    var logOutDir = function (dir) {\n      var dirs = [];\n      try {\n        dirs = fs.readdirSync(dir);\n        console.log(dir);\n      } catch (e) {\n        return;\n      }\n      dirs.forEach(function (subDir) {\n        logOutDir(dir + '/' + subDir);\n      });\n    }\n    logOutDir(dir);\n  }\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/utils.js\n ** module id = 1\n ** module chunks = 0\n **/","module.exports = require(\"path\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"path\"\n ** module id = 2\n ** module chunks = 0\n **/","var MemoryFileSystem = require('memory-fs');\nvar path = require('path');\nvar fs = new MemoryFileSystem();\nvar utils = require('./utils');\n\nmodule.exports = {\n  fs: fs,\n  updateSessionFiles: function (session, files) {\n    if (!fs.existsSync(path.join('/', 'api', 'sandbox', session.id))) {\n      fs.mkdirpSync(path.join('/', 'api', 'sandbox', session.id));\n    }\n\n    files.forEach(function (file) {\n      fs.writeFileSync(path.join('/', 'api', 'sandbox', session.id, file.name), file.content || ' ');\n    });\n  },\n  hasVendorsBundle: function (packages) {\n    var vendorsBundleName = utils.getVendorsBundleName(packages);\n    return fs.existsSync(path.join('/', 'api', 'sandbox', 'vendors', vendorsBundleName,  '/bundle.js'));\n  },\n  writeBundle: function (bundle) {\n    console.log('got bundle', Object.keys(bundle), bundle.name);\n    fs.mkdirpSync(path.join('/', 'api', 'sandbox', 'vendors', bundle.name));\n    fs.writeFileSync(path.join('/', 'api', 'sandbox', 'vendors', bundle.name, 'bundle.js'), bundle.content);\n    fs.writeFileSync(path.join('/', 'api', 'sandbox', 'vendors', bundle.name, 'manifest.json'), bundle.manifest);\n    return bundle.name;\n  }\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/memoryFs.js\n ** module id = 3\n ** module chunks = 0\n **/","module.exports = require(\"memory-fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"memory-fs\"\n ** module id = 4\n ** module chunks = 0\n **/","module.exports = require(\"webpack\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"webpack\"\n ** module id = 5\n ** module chunks = 0\n **/","var db = require('./mongodb.js');\nvar memoryFs = require('./memoryFs.js');\nvar utils = require('./utils');\nvar path = require('path');\n\nmodule.exports = {\n  connect: db.connect,\n  getVendorsBundle: function (packages) {\n    var bundleName = utils.getVendorsBundleName(packages);\n    return db.findOne('bundles', {name: bundleName})\n      .then(function (bundle) {\n        return bundle;\n      });\n  },\n  getVendorsBundleEntries: function (packages) {\n    var bundleName = utils.getVendorsBundleName(packages);\n    return db.findOne('bundles', {name: bundleName}, {entries: 1})\n      .then(function (bundle) {\n        return {\n          vendorsBundle: bundle.name,\n          entries: bundle.entries\n        };\n      });\n  },\n  uploadVendorsBundle: function (result) {\n    var bundleName = result.bundleName;\n    var packagesData = result.packagesData;\n    var manifest = JSON.parse(memoryFs.fs.readFileSync(path.join('/', 'api', 'sandbox', 'vendors', bundleName, 'manifest.json')).toString());\n\n    var entries = packagesData.reduce(function (entries, packageData) {\n      entries[packageData.name] = '.' + path.resolve('/', 'node_modules', packageData.name, packageData.main || 'index.js');\n      return entries;\n    }, {});\n    return db.insert('bundles', {\n      name: bundleName,\n      entries: entries,\n      content: memoryFs.fs.readFileSync(path.join('/', 'api', 'sandbox', 'vendors', bundleName, 'bundle.js')).toString(),\n      manifest: memoryFs.fs.readFileSync(path.join('/', 'api', 'sandbox', 'vendors', bundleName, 'manifest.json')).toString()\n    })\n    .then(function () {\n      return {\n        vendorsBundle: bundleName,\n        entries: entries\n      };\n    })\n    .catch(utils.logError)\n  }\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/database.js\n ** module id = 6\n ** module chunks = 0\n **/","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\nvar MemoryFileSystem = require(\"memory-fs\");\nvar mime = require(\"mime\");\n\nvar HASH_REGEXP = /[0-9a-f]{10,}/;\n\n// constructor for the middleware\nmodule.exports = function(compiler, options, onFileSystemAdded) {\n\tif(!options) options = {};\n\tif(typeof options.watchOptions === \"undefined\") options.watchOptions = {};\n\tif(typeof options.watchDelay !== \"undefined\") {\n\t\t// TODO remove this in next major version\n\t\tconsole.warn(\"options.watchDelay is deprecated: Use 'options.watchOptions.aggregateTimeout' instead\");\n\t\toptions.watchOptions.aggregateTimeout = options.watchDelay;\n\t}\n\tif(typeof options.watchOptions.aggregateTimeout === \"undefined\") options.watchOptions.aggregateTimeout = 200;\n\tif(typeof options.stats === \"undefined\") options.stats = {};\n\tif(!options.stats.context) options.stats.context = process.cwd();\n\tif(options.lazy) {\n\t\tif(typeof options.filename === \"string\") {\n\t\t\tvar str = options.filename\n\t\t\t\t.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\")\n\t\t\t\t.replace(/\\\\\\[[a-z]+\\\\\\]/ig, \".+\");\n\t\t\toptions.filename = new RegExp(\"^[\\/]{0,1}\" + str + \"$\");\n\t\t}\n\t}\n\n\t// store our files in memory\n\tvar files = {};\n\tvar fs = compiler.outputFileSystem = new MemoryFileSystem();\n\n\tonFileSystemAdded && onFileSystemAdded(fs);\n\n\tcompiler.plugin(\"done\", function(stats) {\n\t\t// We are now on valid state\n\t\tstate = true;\n\t\t// Do the stuff in nextTick, because bundle may be invalidated\n\t\t//  if a change happend while compiling\n\t\tprocess.nextTick(function() {\n\t\t\t// check if still in valid state\n\t\t\tif(!state) return;\n\t\t\t// print webpack output\n\t\t\tvar displayStats = (!options.quiet && options.stats !== false);\n\t\t\tif(displayStats &&\n\t\t\t\t!(stats.hasErrors() || stats.hasWarnings()) &&\n\t\t\t\toptions.noInfo)\n\t\t\t\tdisplayStats = false;\n\t\t\tif(displayStats) {\n\t\t\t\tconsole.log(stats.toString(options.stats));\n\t\t\t}\n\t\t\tif (!options.noInfo && !options.quiet)\n\t\t\t\tconsole.info(\"webpack: bundle is now VALID.\");\n\n\t\t\t// execute callback that are delayed\n\t\t\tvar cbs = callbacks;\n\t\t\tcallbacks = [];\n\t\t\tcbs.forEach(function continueBecauseBundleAvailible(cb) {\n\t\t\t\tcb();\n\t\t\t});\n\t\t});\n\n\t\t// In lazy mode, we may issue another rebuild\n\t\tif(forceRebuild) {\n\t\t\tforceRebuild = false;\n\t\t\trebuild();\n\t\t}\n\t});\n\n\t// on compiling\n\tfunction invalidPlugin() {\n\t\tif(state && (!options.noInfo && !options.quiet))\n\t\t\tconsole.info(\"webpack: bundle is now INVALID.\");\n\t\t// We are now in invalid state\n\t\tstate = false;\n\t}\n\tfunction invalidAsyncPlugin(compiler, callback) {\n\t\tconsole.log('watch running!');\n\t\tinvalidPlugin();\n\t\tcallback();\n\t}\n\tcompiler.plugin(\"invalid\", invalidPlugin);\n\tcompiler.plugin(\"watch-run\", invalidAsyncPlugin);\n\tcompiler.plugin(\"run\", invalidAsyncPlugin);\n\n\t// the state, false: bundle invalid, true: bundle valid\n\tvar state = false;\n\n\t// in lazy mode, rebuild automatically\n\tvar forceRebuild = false;\n\n\t// delayed callback\n\tvar callbacks = [];\n\n\t// wait for bundle valid\n\tfunction ready(fn, req) {\n\t\tif(state) return fn();\n\t\tif(!options.noInfo && !options.quiet)\n\t\t\tconsole.log(\"webpack: wait until bundle finished: \" + req.url);\n\t\tcallbacks.push(fn);\n\t}\n\n\t// start watching\n\tif(!options.lazy) {\n\t\tvar watching = compiler.watch(options.watchOptions, function(err) {\n\t\t\tif(err) throw err;\n\t\t});\n\t} else {\n\t\tstate = true;\n\t}\n\n\tfunction rebuild(cb) {\n\t\tif(state) {\n\t\t\tstate = false;\n\t\t\tcompiler.run(function(err) {\n\t\t\t\tif(err) throw err;\n\t\t\t\tcb();\n\t\t\t});\n\t\t} else {\n\t\t\tforceRebuild = true;\n\t\t}\n\t}\n\n\tfunction pathJoin(a, b) {\n\t\treturn a == \"/\" ? \"/\" + b : (a||\"\") + \"/\" + b\n\t}\n\n\tfunction getFilenameFromUrl(url) {\n\t\t// publicPrefix is the folder our bundle should be in\n\t\tvar localPrefix = options.publicPath || \"/\";\n\t\tif(url.indexOf(localPrefix) !== 0) {\n\t\t\tif(/^(https?:)?\\/\\//.test(localPrefix)) {\n\t\t\t\tlocalPrefix = \"/\" + localPrefix.replace(/^(https?:)?\\/\\/[^\\/]+\\//, \"\");\n\t\t\t\t// fast exit if another directory requested\n\t\t\t\tif(url.indexOf(localPrefix) !== 0) return false;\n\t\t\t} else return false;\n\t\t}\n\t\t// get filename from request\n\t\tvar filename = url.substr(localPrefix.length);\n\t\tif(filename.indexOf(\"?\") >= 0) {\n\t\t\tfilename = filename.substr(0, filename.indexOf(\"?\"));\n\t\t}\n\t\treturn filename ? pathJoin(compiler.outputPath, filename) : compiler.outputPath;\n\t}\n\n\t// The middleware function\n\tfunction webpackDevMiddleware(req, res, next, bundleName) {\n\t\tvar filename = bundleName || getFilenameFromUrl(req.url);\n\t\tif (filename === false) return next();\n\n\t\tvar passResponse = function () {\n\t\t\tif(HASH_REGEXP.test(filename)) {\n\t\t\t\ttry {\n\t\t\t\t\tif(fs.statSync(filename).isFile()) {\n\t\t\t\t\t\tprocessRequest();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {}\n\t\t\t}\n\t\t\t// delay the request until we have a vaild bundle\n\t\t\tready(processRequest, req);\n\t\t\tfunction processRequest() {\n\t\t\t\ttry {\n\t\t\t\t\tvar stat = fs.statSync(filename);\n\t\t\t\t\tif(!stat.isFile()) {\n\t\t\t\t\t\tif (stat.isDirectory()) {\n\t\t\t\t\t\t\tfilename = pathJoin(filename, \"index.html\");\n\t\t\t\t\t\t\tstat = fs.statSync(filename);\n\t\t\t\t\t\t\tif(!stat.isFile()) throw \"next\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow \"next\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {\n\t\t\t\t\tconsole.log(e, filename);\n\t\t\t\t\treturn next();\n\t\t\t\t}\n\n\t\t\t\t// server content\n\t\t\t\tconsole.log('reading file', filename);\n\t\t\t\tvar content = fs.readFileSync(filename);\n\t\t\t\tres.setHeader(\"Access-Control-Allow-Origin\", \"*\"); // To support XHR, etc.\n\t\t\t\tres.setHeader(\"Content-Type\", mime.lookup(filename));\n\t\t\t\tres.setHeader(\"Content-Length\", content.length);\n\t\t\t\tif(options.headers) {\n\t\t\t\t\tfor(var name in options.headers) {\n\t\t\t\t\t\tres.setHeader(name, options.headers[name]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (res.send) res.send(content);\n\t\t\t\telse res.end(content);\n\t\t\t}\n\t\t}\n\n\t\t// in lazy mode, rebuild on bundle request\n\t\tif(bundleName || (options.lazy && (!options.filename || options.filename.test(filename)))) {\n\t\t\tconsole.log('Rebundling');\n\t\t\trebuild(passResponse);\n\t\t} else {\n\t\t\tconsole.log('Passing through');\n\t\t\tpassResponse();\n\t\t}\n\t}\n\n\twebpackDevMiddleware.getFilenameFromUrl = getFilenameFromUrl;\n\n\twebpackDevMiddleware.invalidate = function() {\n\t\tif(watching) watching.invalidate();\n\t};\n\twebpackDevMiddleware.close = function(callback) {\n\t\tcallback = callback || function(){};\n\t\tif(watching) watching.close(callback);\n\t\telse callback();\n\t};\n\n\twebpackDevMiddleware.fileSystem = fs;\n\n\treturn webpackDevMiddleware;\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/middleware.js\n ** module id = 7\n ** module chunks = 0\n **/","var utils = require('./utils.js');\nvar path = require('path');\nvar sessions = {};\nvar middleware = require('./middleware');\n\nvar sessionsModule = {\n  get: function (id) {\n    var session = sessions[id];\n    if (session) {\n      sessions[id].lastUpdate = Date.now();\n    }\n    return session;\n  },\n  set: function (id) {\n    sessions[id] = {id: id, lastUpdate: Date.now()};\n    return sessions[id];\n  },\n  update: function (id, key, value) {\n    sessions[id][key] = value;\n    return sessions[id];\n  },\n  clean: function () {\n    var now = Date.now();\n    console.log('Cleaning sessions: ' + Object.keys(sessions).length);\n    sessions = Object.keys(sessions).filter(function (key) {\n      return now - sessions[key].lastUpdate < 60 * 1000 * 5;\n    }).reduce(function (remainingSessions, key) {\n      remainingSessions[key] = sessions[key];\n      return remainingSessions;\n    }, {});\n    console.log('Cleaned sessions: ' + Object.keys(sessions).length);\n  },\n  middleware: function (req, res, next) {\n    if (req.cookies.codebox && sessionsModule.get(req.cookies.codebox)) {\n      req.session = sessionsModule.get(req.cookies.codebox);\n    } else {\n      var id = String(Date.now());\n      req.session = sessionsModule.set(id);\n      res.cookie('codebox', String(id), {\n        expires: 0,\n        domain: utils.isProduction() ? 'webpackbin.herokuapp.com' : '.codebox.dev',\n        httpOnly: true\n      });\n    }\n    next();\n  },\n  createBundleMiddleware: function (req, res, next) {\n    return function (compiler) {\n      return new Promise(function (resolve, reject) {\n        console.log('Creating bundle middleware');\n        var resolver = function () {\n          resolve();\n          next();\n        };\n        var sessionMiddleware = middleware(compiler, {\n          lazy: true,\n          filename: new RegExp(req.session.id),\n          publicPath: path.join('/', 'api', 'sandbox', req.session.id),\n          stats: {\n            colors: true,\n            hash: false,\n            timings: true,\n            chunks: true,\n            chunkModules: false,\n            modules: false\n          }\n        });\n        sessionsModule.update(req.session.id, 'middleware', sessionMiddleware);\n        sessionMiddleware(req, res, resolver, path.join('/', 'api', 'sandbox', req.session.id, 'webpackbin_bundle.js'));\n      });\n    };\n  },\n  updateVendorsBundle: function (session) {\n    return function (result) {\n      sessions[session.id].vendorsBundle = result.vendorsBundle;\n      return result;\n    }\n  }\n};\n\nmodule.exports = sessionsModule;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/sessions.js\n ** module id = 8\n ** module chunks = 0\n **/","module.exports = require(\"fs\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"fs\"\n ** module id = 9\n ** module chunks = 0\n **/","module.exports = require(\"mime\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mime\"\n ** module id = 10\n ** module chunks = 0\n **/","var express = require('express');\nvar webpack = require('webpack');\nvar compression = require('compression');\nvar app = express();\nvar MemoryFileSystem = require(\"memory-fs\");\nvar memoryFs = require('./memoryFs');\nvar middleware = require('./middleware');\nvar fs = require('fs');\nvar path = require('path');\nvar cookieParser = require('cookie-parser');\nvar bodyParser = require('body-parser');\nvar sessions = require('./sessions.js');\nvar middlewares = {};\nvar preLoadPackages = require('./preLoadPackages');\nvar utils = require('./utils');\nvar sandbox = require('./sandbox');\nvar database = require('./database');\n\npreLoadPackages([\n  'process',\n  'babel-loader',\n  'style-loader',\n  'css-loader'\n]);\n\n// Init\nmemoryFs.fs.mkdirpSync(path.join('/', 'api', 'sandbox'));\nmemoryFs.fs.mkdirpSync(path.join('/', 'api', 'sandbox', 'vendors'));\nsetInterval(sessions.clean, 60 * 1000 * 5);\ndatabase.connect('mongodb://localhost:27017/webpackbin')\n  .then(utils.log('Database connected'))\n  .catch(utils.log('Could not connect to database'));\n\n// Init middleware\napp.use(compression())\napp.use(cookieParser());\napp.use(bodyParser.json());\napp.use(sessions.middleware);\napp.use(express.static(path.resolve('public')));\n\napp.get('/', function(req, res) {\n  res.send(fs.readFileSync(\n    path.resolve('index.html')).toString().replace('/build/bundle.js', '/client_build.js')\n  );\n});\n\napp.get('/api/sandbox/', sandbox.getIndex);\n\napp.get('/api/sandbox/*', sandbox.getFile)\n\napp.post('/api/sandbox', sandbox.updateSandbox);\n\nmodule.exports = app;\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/index.js\n ** module id = 11\n ** module chunks = 0\n **/","var utils = require('./utils.js');\nvar MongoClient = require('mongodb').MongoClient;\nvar db = null;\n\nmodule.exports = {\n  connect: function (url) {\n    return new Promise(function (resolve, reject) {\n      MongoClient.connect(url, function(err, connectedDb) {\n        if (err) {\n          return reject(err);\n        }\n        db = connectedDb;\n        resolve();\n      });\n    })\n  },\n  findOne: function (collectionName, query, options) {\n    return new Promise(function (resolve, reject) {\n      var collection = db.collection(collectionName);\n      collection.findOne(query, options || {}, function (err, doc) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(doc);\n      });\n    });\n  },\n  insert: function (collectionName, doc) {\n    return new Promise(function (resolve, reject) {\n      var collection = db.collection(collectionName);\n      collection.insert(doc, function (err, doc) {\n        if (err) {\n          return reject(err);\n        }\n        resolve(doc);\n      });\n    });\n  }\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/mongodb.js\n ** module id = 12\n ** module chunks = 0\n **/","var npmExtractor = require('npm-extractor');\nvar memoryFs = require('./memoryFs.js');\nvar utils = require('./utils');\n\nmodule.exports = {\n  loadPackages: function (packages) {\n    console.log('Load packages', packages, Object.keys(packages));\n    return Promise.all(Object.keys(packages).map(function (key) {\n      return npmExtractor({\n        package: key,\n        targetFs: memoryFs.fs,\n        options: {\n          registry: 'http://registry.npmjs.org/',\n          mindelay: 5000,\n          maxDelay: 10000,\n          retries: 5,\n          factor: 5\n        },\n        dest: 'node_modules'\n      });\n    }))\n    .then(function (packagesData) {\n      console.log('Loaded packages into memory');\n      return {\n        packages: packages,\n        packagesData: packagesData\n      };\n    })\n    .catch(function (err) {\n      console.log(err);\n    });\n  }\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/npm.js\n ** module id = 13\n ** module chunks = 0\n **/","var memoryFs = require('./memoryFs');\nvar path = require('path');\nvar fs = require('fs');\nvar recursive = require('recursive-readdir');\n\nvar loadedDeps = [];\n\nvar preLoadPackage = function (name) {\n  if (loadedDeps.indexOf(name) >= 0) {\n    return;\n  }\n  loadedDeps.push(name);\n  setTimeout(function () {\n    var packagePath = path.resolve('node_modules', name);\n    var packageJson = JSON.parse(fs.readFileSync(path.join(packagePath, 'package.json')).toString());\n\n    recursive(packagePath, function (err, files) {\n      files.forEach(function (file) {\n        var relativeFile = file;\n        var paths = relativeFile.split(path.sep).slice(1);\n        paths.reduce(function (currentPath, pathPart, index) {\n          currentPath += path.sep + pathPart;\n          if (index < paths.length - 1 && !memoryFs.fs.existsSync(currentPath)) {\n            memoryFs.fs.mkdirpSync(currentPath);\n          }\n          return currentPath;\n        }, '');\n\n        if (path.extname(relativeFile)) {\n          var content = fs.readFileSync(file, 'utf8');\n          memoryFs.fs.writeFileSync(relativeFile, content || ' ');\n        }\n      });\n    });\n    Object.keys(packageJson.dependencies || {}).forEach(preLoadPackage);\n  })\n}\n\nmodule.exports = function (packages) {\n  packages.forEach(preLoadPackage);\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/preLoadPackages.js\n ** module id = 14\n ** module chunks = 0\n **/","var db = require('./database.js');\nvar vendorsBundler = require('./vendorsBundler.js');\nvar sessionBundler = require('./sessionBundler.js');\nvar memoryFs = require('./memoryFs');\nvar utils = require('./utils');\nvar sessions = require('./sessions');\nvar npm = require('./npm');\nvar path = require('path');\nvar mime = require('mime');\n\nvar createIndex = function (req) {\n  return [\n    '<!DOCTYPE html>',\n    '<html>',\n    ' <head>',\n    '   <script>',\n    '     window.addEventListener(\"load\", function () {window.parent.postMessage({type: \"loaded\"}, location.origin)});',\n    '   </script>',\n    ' </head>',\n    ' <body>',\n    '   <div id=\"app\"></div>',\n    req.session.vendorsBundle ? '   <script src=\"/api/sandbox/vendors/' + req.session.vendorsBundle + '/bundle.js\" defer></script>' : '',\n    '   <script src=\"/api/sandbox/webpackbin_bundle.js\" defer></script>',\n    ' </body>',\n    '</html>'\n  ].join('\\n')\n}\n\nmodule.exports = {\n  getIndex: function (req, res) {\n    res.type('html');\n    res.send(createIndex(req));\n  },\n  getFile: function (req, res, next) {\n    if (/webpackbin_bundle\\.js/.test(req.url)) {\n      req.url = req.url.replace('webpackbin_bundle.js', req.session.id + '/webpackbin_bundle.js');\n      req.session.middleware(req, res, next);\n      return;\n    }\n\n    if (/\\/api\\/sandbox\\/vendors/.test(req.url)) {\n      console.log('Getting vendors bundle', req.url);\n      var fileName = path.basename(req.url);\n      var content = memoryFs.fs.readFileSync(req.url);\n      res.setHeader('Cache-Control', 'public, max-age=3600000');\n      res.setHeader(\"Content-Type\", mime.lookup(fileName));\n      res.setHeader(\"Content-Length\", content.length);\n      res.send(content);\n      return\n    }\n  },\n  updateSandbox: function (req, res, next) {\n\n    memoryFs.updateSessionFiles(req.session, req.body.files);\n\n    if (req.session.middleware) {\n      return res.send({});\n    }\n\n    if (\n      !req.session.middleware &&\n      utils.hasPackages(req) &&\n      !memoryFs.hasVendorsBundle(req.body.packages)\n    ) {\n\n      return db.getVendorsBundle(req.body.packages)\n        .then(function (bundle) {\n          if (bundle) {\n            memoryFs.writeBundle(bundle);\n            return bundle.name;\n          } else {\n            return npm.loadPackages(req.body.packages)\n              .then(vendorsBundler.compile)\n              .then(db.uploadVendorsBundle);\n          }\n        })\n        .then(sessions.updateVendorsBundle(req.session))\n        .then(sessionBundler.create(req.session))\n        .then(sessions.createBundleMiddleware(req, res, next))\n        .catch(utils.logError);\n\n    } else if (\n      !req.session.middleware &&\n      utils.hasPackages(req) &&\n      memoryFs.hasVendorsBundle(req.body.packages)\n    ) {\n\n      sessions.updateVendorsBundle(req.session)(utils.getVendorsBundleName(req.body.packages));\n\n      db.getVendorsBundleEntries(req.body.packages)\n        .then(sessionBundler.create(req.session))\n        .then(sessions.createBundleMiddleware(req, res, next))\n        .catch(utils.logError);\n\n    } else if (\n      !req.session.middleware\n    ) {\n      sessionBundler.create(req.session)()\n        .then(sessions.createBundleMiddleware(req, res, next))\n        .catch(utils.logError);\n    }\n  }\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/sandbox.js\n ** module id = 15\n ** module chunks = 0\n **/","var webpack = require('webpack');\nvar memoryFs = require('./memoryFs');\nvar path = require('path');\nvar utils = require('./utils');\n\nmodule.exports = {\n  create: function (session) {\n    return function (result) {\n      var vendorsBundleName = result.vendorsBundle;\n      var entries = result.entries;\n      \n      console.log('Got bundle', vendorsBundleName);\n      return new Promise(function (resolve, reject) {\n\n        var externals = null;\n        var plugins = [\n          new webpack.DefinePlugin({\n            'process.env': {\n              'NODE_ENV': JSON.stringify('production'),\n            }\n          })\n        ];\n\n        if (vendorsBundleName) {\n          var manifest = JSON.parse(memoryFs.fs.readFileSync(path.join('/', 'api', 'sandbox', 'vendors', vendorsBundleName, 'manifest.json')).toString());\n          plugins = plugins.concat(\n            new webpack.DllReferencePlugin({\n              context: '/',\n              manifest: manifest\n            })\n          );\n\n          console.log(entries);\n          if (entries) {\n            externals = Object.keys(entries).reduce(function (externals, key) {\n              externals[key] = 'webpackbin_vendors(' + manifest.content[entries[key]] + ')';\n              return externals;\n            }, {});\n          }\n\n        }\n\n        console.log(externals);\n\n        var compiler = webpack({\n          devtool: 'cheap-eval-source-map',\n          entry: {\n            App: path.join('/', 'api', 'sandbox', session.id, 'main.js')\n          },\n          output: {\n            path: path.join('/', 'api', 'sandbox', session.id),\n            filename: 'webpackbin_bundle.js'\n          },\n          resolveLoader: {\n            root: path.resolve('node_modules')\n          },\n          resolve: {\n            root: path.join('/', 'node_modules')\n          },\n          externals: externals,\n          module: {\n            loaders: [{\n              test: /\\.css?$/,\n              loader: 'style!css?modules&localIdentName=[name]---[local]---[hash:base64:5]'\n            }, {\n              test: /\\.js?$/,\n              exclude: /node_modules/,\n              loader: 'babel',\n              query: {\n                \"presets\": [\"react\", \"es2015\", \"stage-0\"]\n              }\n            }]\n          },\n          plugins: plugins\n        });\n\n        compiler.inputFileSystem = memoryFs.fs;\n        compiler.resolvers.normal.fileSystem = memoryFs.fs;\n        compiler.resolvers.context.fileSystem = memoryFs.fs;\n\n        console.log('Bundler created');\n\n        resolve(compiler);\n      });\n    }\n  }\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/sessionBundler.js\n ** module id = 16\n ** module chunks = 0\n **/","var webpack = require('webpack');\nvar utils = require('./utils.js');\nvar memoryFs = require('./memoryFs');\nvar path = require('path');\nvar utils = require('./utils');\n\nmodule.exports = {\n  compile: function (result) {\n    var packages = result.packages;\n    return new Promise(function (resolve, reject) {\n      var bundleName = utils.getVendorsBundleName(packages);\n          console.log('creating compiler', bundleName);\n      var vendorsCompiler = webpack({\n        entry: {\n          vendors: Object.keys(packages)\n        },\n        output: {\n          path: path.join('/', 'api', 'sandbox', 'vendors', bundleName),\n          filename: 'bundle.js',\n          library: 'webpackbin_vendors'\n        },\n        resolveLoader: {\n          root: path.resolve('node_modules')\n        },\n        resolve: {\n          root: path.join('/', 'node_modules')\n        },\n        plugins: [\n          new webpack.DllPlugin({\n           path: path.join('/', 'api', 'sandbox', 'vendors', bundleName, 'manifest.json'),\n           name: 'webpackbin_vendors',\n           context: '/'\n         })\n        ]\n      });\n      vendorsCompiler.outputFileSystem = memoryFs.fs;\n      vendorsCompiler.inputFileSystem = memoryFs.fs;\n      vendorsCompiler.resolvers.normal.fileSystem = memoryFs.fs;\n      vendorsCompiler.resolvers.context.fileSystem = memoryFs.fs;\n      console.log('running compiler');\n      vendorsCompiler.run(function (err) {\n        console.log('Compiled vendors');\n        if (err) {\n          return reject(err);\n        }\n        resolve({\n          bundleName: bundleName,\n          packagesData: result.packagesData\n        });\n      });\n    })\n    .catch(utils.logError);\n  }\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./server/vendorsBundler.js\n ** module id = 17\n ** module chunks = 0\n **/","var app = require('./server'),\n    http = require('http');\n\nvar server = http.createServer(app);\n\nserver.listen(process.env.NODE_ENV === 'production' ? process.env.PORT : 4000);\n\nif (module.hot) {\n\n  // This will handle HMR and reload the server\n  module.hot.accept('./server', function() {\n    server.removeListener('request', app);\n    app = require('./server');\n    server.on('request', app);\n    console.log('Server reloaded!');\n  });\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./start.js\n ** module id = 18\n ** module chunks = 0\n **/","module.exports = require(\"body-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"body-parser\"\n ** module id = 19\n ** module chunks = 0\n **/","module.exports = require(\"compression\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"compression\"\n ** module id = 20\n ** module chunks = 0\n **/","module.exports = require(\"cookie-parser\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"cookie-parser\"\n ** module id = 21\n ** module chunks = 0\n **/","module.exports = require(\"express\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"express\"\n ** module id = 22\n ** module chunks = 0\n **/","module.exports = require(\"http\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"http\"\n ** module id = 23\n ** module chunks = 0\n **/","module.exports = require(\"mongodb\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"mongodb\"\n ** module id = 24\n ** module chunks = 0\n **/","module.exports = require(\"npm-extractor\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"npm-extractor\"\n ** module id = 25\n ** module chunks = 0\n **/","module.exports = require(\"recursive-readdir\");\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"recursive-readdir\"\n ** module id = 26\n ** module chunks = 0\n **/"],"sourceRoot":""}